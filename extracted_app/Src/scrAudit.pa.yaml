# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrAudit:
    Properties:
      Fill: =gblTheme.Background
      LoadingSpinnerColor: =gblTheme.Accent
      OnVisible: |-
        =Set(
            gblDevice,
            {
                Width: App.Width,
                Height: App.Height,
                IsPhone: App.Width < 768,
                IsTablet: App.Width >= 768 And App.Width < 1024,
                IsDesktop: App.Width >= 1024,
                Padding: If(App.Width < 768, 12, If(App.Width < 1024, 20, 36)),
                HeaderHeight: If(App.Width < 768, 56, If(App.Width < 1024, 72, 88)),
                ButtonHeight: If(App.Width < 768, 64, If(App.Width < 1024, 76, 90)),
                InputHeight: If(App.Width < 768, 48, 60),
                CardRadius: If(App.Width < 768, 6, 10),
                ButtonRadius: If(App.Width < 768, 6, 8),
                FontScale: If(App.Width < 768, 0.9, If(App.Width < 1024, 0.95, 1))
            }
        );
        UpdateContext({locCurrentAuditStep: 1});
        // Recalculate score on load
        Select(btnRecalculateScore);
    Children:
      - hedAuditHeader:
          Control: Header@0.0.44
          Properties:
            BorderColor: =gblTheme.Border
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =1
            Fill: =gblTheme.Surface
            FontColor: =gblTheme.PrimaryDark
            Height: =gblDevice.HeaderHeight
            Title: =gblSelectedFacility.Title & " - " & gblAuditType & " Audit"
            TitleFontSize: =20 * gblDevice.FontScale
      - btnRecalculateScore:
          Control: Classic/Button@2.2.0
          Properties:
            Height: =0
            OnSelect: |-
              =Set(
                  gblAuditScore,
                  With(
                      {
                          penaltyTable: AddColumns(
                              colFindings,
                              "Penalty",
                              Switch(
                                  Severity,
                                  "Major", gblScoringWeights.Major,
                                  "Minor", gblScoringWeights.Minor,
                                  "Observation", gblScoringWeights.Observation,
                                  0
                              )
                          )
                      },
                      Max(
                          0,
                          gblScoringWeights.BaseScore - Sum(penaltyTable, Penalty)
                      )
                  )
              )
            Text: =""
            Visible: =false
            Width: =0
            X: =0
            Y: =0
      - conAddFindingDialog:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(0, 0, 0, 0.8)
            Height: =Parent.Height
            Visible: =varShowAddFinding
            Width: =Parent.Width
          Children:
            - conFindingForm:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =gblTheme.Surface
                  Height: =If(gblDevice.IsPhone, Parent.Height - 40, 650)
                  RadiusBottomLeft: =12
                  RadiusBottomRight: =12
                  RadiusTopLeft: =12
                  RadiusTopRight: =12
                  Width: =If(gblDevice.IsPhone, Parent.Width - 20, Min(800, Parent.Width - 40))
                  X: =(Parent.Width - Self.Width) / 2
                  Y: =If(gblDevice.IsPhone, 20, (Parent.Height - Self.Height) / 2)
                Children:
                  - lblFindingFormTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =gblTheme.TextSecondary
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =30
                        Size: =20 * gblDevice.FontScale
                        Text: ="Add New Finding"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =20
                  - txtFindingDescription:
                      Control: Classic/TextInput@2.3.2
                      Properties:
                        BorderColor: =gblTheme.Border
                        Font: =Font.'Segoe UI'
                        Height: =100
                        HintText: ="Describe the finding in detail..."
                        Mode: =TextMode.MultiLine
                        Size: =14 * gblDevice.FontScale
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =60
                  - lblSeverityAssessment:
                      Control: Label@2.5.1
                      Properties:
                        Color: =gblTheme.TextSecondary
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Semibold
                        Height: =25
                        Size: =16 * gblDevice.FontScale
                        Text: ="Severity Assessment:"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =180
                  - chkHealthDanger:
                      Control: Classic/CheckBox@2.1.0
                      Properties:
                        CheckmarkFill: =gblTheme.Error
                        Font: =Font.'Segoe UI'
                        Height: =40
                        OnCheck: |-
                          =Set(varIsMajor, true);
                          UpdateContext({locMajorType: "Health/Environmental"})
                        OnUncheck: |-
                          =If(!chkSovereignty.Value, Set(varIsMajor, false));
                          UpdateContext({locMajorType: If(chkSovereignty.Value, "Sovereignty", "")})
                        Size: =14 * gblDevice.FontScale
                        Text: ="Immediately dangerous to human health or environment?"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =210
                  - chkSovereignty:
                      Control: Classic/CheckBox@2.1.0
                      Properties:
                        CheckmarkFill: =gblTheme.Warning
                        Font: =Font.'Segoe UI'
                        Height: =40
                        OnCheck: |-
                          =Set(varIsMajor, true);
                          UpdateContext({locMajorType: If(chkHealthDanger.Value, "Health/Environmental", "Sovereignty")})
                        OnUncheck: |-
                          =If(!chkHealthDanger.Value, Set(varIsMajor, false));
                          UpdateContext({locMajorType: If(chkHealthDanger.Value, "Health/Environmental", "")})
                        Size: =14 * gblDevice.FontScale
                        Text: ="Detrimental to Choctaw Nation sovereignty?"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =260
                  - lblSeverityHelp:
                      Control: Label@2.5.1
                      Properties:
                        Color: =gblTheme.TextSecondary
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Semibold
                        Height: =25
                        Size: =14 * gblDevice.FontScale
                        Text: ="Major findings require selecting a type below. Minor issues and Observations do not affect sovereignty."
                        X: =20
                        Y: =310
                  - radSeverity:
                      Control: Classic/Radio@2.3.0
                      Properties:
                        Default: =If(varIsMajor, "Major", "Minor")
                        Font: =Font.'Segoe UI'
                        Items: |-
                          =If(varIsMajor, 
                              Table({Value: "Major - " & If(IsBlank(locMajorType), "Select type above", locMajorType)}),
                              Table({Value: "Minor"}, {Value: "Observation"})
                            )
                        Items.Value: =Value
                        Layout: =Layout.Horizontal
                        Size: =14 * gblDevice.FontScale
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =340
                  - chkFixedOnSite:
                      Control: Classic/CheckBox@2.1.0
                      Properties:
                        CheckmarkFill: =gblTheme.Success
                        Font: =Font.'Segoe UI'
                        Height: =40
                        OnCheck: =Set(varFixedOnSite, true)
                        OnUncheck: =Set(varFixedOnSite, false)
                        Size: =14 * gblDevice.FontScale
                        Text: ="✓ Fixed on-site during inspection"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =450
                  - btnCancelFinding:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =gblTheme.Border
                        Color: =gblTheme.TextSecondary
                        Fill: =gblTheme.Surface
                        Font: =Font.'Segoe UI'
                        Height: =50
                        OnSelect: |-
                          =Set(varShowAddFinding, false);
                          Reset(txtFindingDescription);
                          Reset(chkHealthDanger);
                          Reset(chkSovereignty);
                          Reset(chkFixedOnSite);
                          Set(varIsMajor, false);
                          Set(varFixedOnSite, false);
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Size: =14 * gblDevice.FontScale
                        Text: ="Cancel"
                        Width: =120
                        X: =Parent.Width - 280
                        Y: =If(gblDevice.IsPhone, Parent.Height - 80, 550)
                  - btnSaveFinding:
                      Control: Classic/Button@2.2.0
                      Properties:
                        Color: =gblTheme.TextPrimary
                        Fill: =gblTheme.Success
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =50
                        OnSelect: |-
                          =Collect(
                              colFindings,
                              {
                                  FindingID: GUID(),
                                  Issue: txtFindingDescription.Text,
                                  Severity: radSeverity.Selected.Value,
                                  MajorType: If(varIsMajor, locMajorType, ""),
                                  Category: "Manual Entry",
                                  SubCategory: "Inspection",
                                  SpecificIssue: "Manual Finding",
                                  RootCause: "To be determined",
                                  QuickFix: "To be determined",
                                  Notes: "",
                                  FixedOnSite: varFixedOnSite,
                                  Photos: Table(),
                                  Timestamp: Now(),
                                  AuditStep: locCurrentAuditStep
                              }
                          );
                          Set(varShowAddFinding, false);
                          Reset(txtFindingDescription);
                          Reset(chkHealthDanger);
                          Reset(chkSovereignty);
                          Reset(chkFixedOnSite);
                          Set(varIsMajor, false);
                          Set(varFixedOnSite, false);
                          Select(btnRecalculateScore);
                          Notify("Finding added successfully", NotificationType.Success);
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Size: =14 * gblDevice.FontScale
                        Text: ="Save Finding"
                        Width: =140
                        X: =Parent.Width - 160
                        Y: =If(gblDevice.IsPhone, Parent.Height - 80, 550)
      - svMainContent:
          Control: Gallery@2.15.0
          Variant: BrowseLayout_Vertical_TwoTextVariant_ver5.0
          Properties:
            BorderColor: =RGBA(245, 245, 245, 1)
            Fill: =gblTheme.Background
            Height: =Parent.Height - hedAuditHeader.Height - conProgress_2.Height - conNavigation.Height
            Items: =[1]
            TemplateSize: =2200
            Width: =Parent.Width
            Y: =190
          Children:
            - conMainContent:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Height: =Parent.TemplateHeight
                  Width: =Min(1000, Parent.Width - 40)
                  X: =(Parent.Width - Self.Width) / 2
                Children:
                  - conStep4_Conditions:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =1
                        Fill: =gblTheme.Surface
                        Height: =650
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Visible: =locCurrentAuditStep = 4
                        Width: =Parent.Width
                        Y: |+
                          =20
                      Children:
                        - lblConditionsTitle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextSecondary
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Bold
                              Size: =20 * gblDevice.FontScale
                              Text: |-
                                =If(gblAuditType = "SWPPP", "🌧️ SWPPP Observations", "📷 Site Conditions & Observations")
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =20
                        - galConditionsChecklist:
                            Control: Gallery@2.15.0
                            Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              BorderThickness: =1
                              Height: =417
                              Items: |+
                                =If(
                                        gblAuditType = "SWPPP",
                                        Table(
                                            {ID: 1, Item: "Permits Non-Compliance", Flag: "NC Permits", Severity: "Major", IsChecked: false, IsNegative: true},
                                            {ID: 2, Item: "Program Documentation Non-Compliance", Flag: "NC Program Documentation", Severity: "Minor", IsChecked: false, IsNegative: true},
                                            {ID: 3, Item: "Erosion Control Non-Compliance", Flag: "NC Erosion Control", Severity: "Major", IsChecked: false, IsNegative: true},
                                            {ID: 4, Item: "Waste/Stored Material Mgmt Non-Compliance", Flag: "NC Mgmt Waste/Stored Material", Severity: "Major", IsChecked: false, IsNegative: true},
                                            {ID: 5, Item: "Repeat Violations Found", Flag: "NC Repeat Violations", Severity: "Major", IsChecked: false, IsNegative: true}
                                        ),
                                        If(
                                            gblAuditType = "Housing ECR",
                                            Table(
                                                {ID: 1, Item: "Building exterior condition acceptable?", Flag: "Housing_Exterior", Severity: "Major", IsChecked: false, IsNegative: false},
                                                {ID: 2, Item: "Landscaping and grounds maintained?", Flag: "Housing_Grounds", Severity: "Minor", IsChecked: false, IsNegative: false},
                                                {ID: 3, Item: "Waste containers adequate and properly placed?", Flag: "Housing_WasteContainers", Severity: "Minor", IsChecked: false, IsNegative: false},
                                                {ID: 4, Item: "Common areas clean and safe?", Flag: "Housing_CommonAreas", Severity: "Major", IsChecked: false, IsNegative: false},
                                                {ID: 5, Item: "Parking areas maintained?", Flag: "Housing_Parking", Severity: "Minor", IsChecked: false, IsNegative: false},
                                                {ID: 6, Item: "Pest control issues present?", Flag: "Housing_PestControl", Severity: "Major", IsChecked: false, IsNegative: true},
                                                {ID: 7, Item: "Mold or moisture issues visible?", Flag: "Housing_MoldMoisture", Severity: "Major", IsChecked: false, IsNegative: true},
                                                {ID: 8, Item: "HVAC systems functioning properly?", Flag: "Housing_HVAC", Severity: "Major", IsChecked: false, IsNegative: false},
                                                {ID: 9, Item: "Plumbing fixtures working properly?", Flag: "Housing_Plumbing", Severity: "Major", IsChecked: false, IsNegative: false},
                                                {ID: 10, Item: "Electrical systems safe and functional?", Flag: "Housing_Electrical", Severity: "Major", IsChecked: false, IsNegative: false}
                                            ),
                                            Table(
                                                {ID: 1, Item: "Signs of dumping?", Flag: "Dumping", Severity: "Major", IsChecked: false, IsNegative: true},
                                                {ID: 2, Item: "Staining on ground?", Flag: "Staining", Severity: "Major", IsChecked: false, IsNegative: true},
                                                {ID: 3, Item: "Dumpsters overflowing?", Flag: "Dumpsters", Severity: "Minor", IsChecked: false, IsNegative: true},
                                                {ID: 4, Item: "Water damage visible?", Flag: "WaterDamage", Severity: "Major", IsChecked: false, IsNegative: true},
                                                {ID: 5, Item: "Recycling program active?", Flag: "NoRecycling", Severity: "Observation", IsChecked: false, IsNegative: false},
                                                {ID: 6, Item: "Housekeeping adequate?", Flag: "PoorHousekeeping", Severity: "Minor", IsChecked: false, IsNegative: false},
                                                {ID: 7, Item: "Fire extinguishers current?", Flag: "ExpiredExtinguishers", Severity: "Major", IsChecked: false, IsNegative: false},
                                                {ID: 8, Item: "Emergency exits clear?", Flag: "BlockedExits", Severity: "Major", IsChecked: false, IsNegative: false}
                                            )
                                        )
                                    )
                              TemplateSize: =50
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =lblConditionsTitle.Y + lblConditionsTitle.Height + 20
                            Children:
                              - recCheckBg:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Fill: =gblTheme.Surface
                                    Height: =Parent.TemplateHeight - 4
                                    Width: =Parent.Width - 8
                                    X: =4
                                    Y: =2
                              - lblCheckItem:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Size: =16 * gblDevice.FontScale
                                    Text: =ThisItem.Item
                                    Width: =Parent.Width - 160
                                    X: =20
                                    Y: =10
                              - togCheckItem:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    FalseText: =If(ThisItem.IsNegative, "No", "Yes")
                                    Height: =35
                                    OnCheck: |-
                                      =If(
                                          !ThisItem.IsNegative,
                                          RemoveIf(
                                              colFindings,
                                              Issue = ThisItem.Flag
                                          )
                                      );
                                      Select(btnRecalculateScore);
                                    OnUncheck: |-
                                      =If(
                                          ThisItem.IsNegative,
                                          Collect(
                                              colFindings,
                                              {
                                                  FindingID: GUID(),
                                                  Issue: ThisItem.Flag,
                                                  Severity: ThisItem.Severity,
                                                  Category: "Site Conditions",
                                                  SubCategory: "Observations",
                                                  SpecificIssue: ThisItem.Item,
                                                  RootCause: "Site Issue",
                                                  QuickFix: "Address identified issue",
                                                  Notes: "",
                                                  Photos: Table(),
                                                  Timestamp: Now(),
                                                  AuditStep: 4
                                              }
                                          );
                                          Notify("Site condition issue flagged - review in Step 5", NotificationType.Information, 2000);
                                      );
                                      Select(btnRecalculateScore);
                                    TrueFill: =If(ThisItem.IsNegative, gblTheme.Warning, gblTheme.Success)
                                    TrueText: =If(ThisItem.IsNegative, "Yes", "No")
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =10
                              - lblSeverityIndicator:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    Color: |-
                                      =Switch(
                                                  ThisItem.Severity, 
                                                  "Major", gblTheme.Error, 
                                                  "Minor", gblTheme.Warning, 
                                                  gblTheme.TextTertiary  // Observation
                                              )
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Size: =10 * gblDevice.FontScale
                                    Text: =Upper(ThisItem.Severity)
                                    Width: =184
                                    X: =350
                                    Y: =65
                        - conStormWater:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =180
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType in ["ECR", "SWPPP"]
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =galConditionsChecklist.Y + galConditionsChecklist.Height + 20
                            Children:
                              - lblStormWater:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="🌧️ Storm Water Observations:"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - cbStormWater:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    DisplayFields: =["Value"]
                                    Height: =100
                                    Items: |-
                                      =Table(
                                          {Value: "Clear discharge"},
                                          {Value: "Discolored water"},
                                          {Value: "Oil sheen visible"},
                                          {Value: "Debris in drains"},
                                          {Value: "Erosion present"},
                                          {Value: "BMPs in place"},
                                          {Value: "BMPs need maintenance"}
                                      )
                                    OnChange: |-
                                      =ForAll(
                                          Self.SelectedItems As SelectedItem,
                                          If(
                                              SelectedItem.Value in ["Discolored water", "Oil sheen visible", "Debris in drains", "Erosion present", "BMPs need maintenance"],
                                              Collect(
                                                  colFindings,
                                                  {
                                                      FindingID: GUID(),
                                                      Issue: "Storm water: " & SelectedItem.Value,
                                                      Severity: "High",
                                                      Category: "Environmental",
                                                      SubCategory: "Storm Water",
                                                      SpecificIssue: "Stormwater/Erosion",
                                                      RootCause: "Maintenance Issue",
                                                      QuickFix: Switch(
                                                          SelectedItem.Value,
                                                          "Discolored water", "Investigate source of discoloration",
                                                          "Oil sheen visible", "Deploy absorbent materials and find source",
                                                          "Debris in drains", "Clear debris from storm drains",
                                                          "Erosion present", "Install erosion control measures",
                                                          "BMPs need maintenance", "Repair/replace BMPs",
                                                          ""
                                                      ),
                                                      Notes: "",
                                                      Photos: Table(),
                                                      Timestamp: Now(),
                                                      AuditStep: 4
                                                  }
                                              )
                                          )
                                      )
                                    SearchFields: =["Value"]
                                    Size: =16 * gblDevice.FontScale
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =60
                        - conOtherHazards:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =450
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType = "ECR"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =600
                            Children:
                              - lblOtherHazards:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: ="⚠️ Other Hazards or Concerns:"
                                    Width: =Parent.Width - 220
                                    X: =20
                                    Y: =20
                              - galOtherHazards:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderThickness: =1
                                    Height: =320
                                    Items: =Filter(colFindings, StartsWith(Issue, "Other hazard:"))
                                    TemplateSize: =90
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =60
                                  Children:
                                    - Title11:
                                        Control: Label@2.5.1
                                        Properties:
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(50, 49, 48, 1)
                                          DisabledColor: =RGBA(161, 159, 157, 1)
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                                          Height: =Self.Size * 1.8
                                          OnSelect: =Select(Parent)
                                          PaddingBottom: =0
                                          PaddingLeft: =12
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =14
                                          Text: =ThisItem.Category
                                          VerticalAlign: =VerticalAlign.Top
                                          Width: =Parent.TemplateWidth - 86
                                          X: =16
                                          Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2)
                                    - NextArrow8:
                                        Control: Classic/Icon@2.5.0
                                        Properties:
                                          AccessibleLabel: =Self.Tooltip
                                          BorderColor: =RGBA(0, 0, 0, 0)
                                          Color: =RGBA(166, 166, 166, 1)
                                          DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                          DisabledColor: =RGBA(225, 223, 221, 1)
                                          DisabledFill: =RGBA(0, 0, 0, 0)
                                          FocusedBorderThickness: =4
                                          Height: =50
                                          HoverBorderColor: =RGBA(0, 0, 0, 0)
                                          HoverColor: =RGBA(16, 110, 190, 1)
                                          HoverFill: =RGBA(0, 0, 0, 0)
                                          Icon: =Icon.ChevronRight
                                          OnSelect: =Select(Parent)
                                          PaddingBottom: =12
                                          PaddingLeft: =12
                                          PaddingRight: =12
                                          PaddingTop: =12
                                          PressedBorderColor: =RGBA(0, 0, 0, 0)
                                          PressedColor: =RGBA(16, 110, 190, 1)
                                          PressedFill: =RGBA(0, 0, 0, 0)
                                          Tooltip: ="View item details"
                                          Width: =50
                                          X: =Parent.TemplateWidth - Self.Width - 12
                                          Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2)
                                    - Separator8:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =RGBA(0, 0, 0, 0)
                                          Fill: =RGBA(255, 255, 255, 1)
                                          Height: =8
                                          OnSelect: =Select(Parent)
                                          Width: =Parent.TemplateWidth
                                          Y: =Parent.TemplateHeight - Self.Height
                                    - Rectangle8:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =RGBA(0, 0, 0, 0)
                                          Fill: =RGBA(0, 120, 212, 1)
                                          Height: =Parent.TemplateHeight - Separator8.Height
                                          OnSelect: =Select(Parent)
                                          Visible: =ThisItem.IsSelected
                                          Width: =4
                                    - recHazardBg:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =Switch(ThisItem.Severity, "Critical", gblTheme.Error, "High", gblTheme.Warning, gblTheme.BorderLight)
                                          BorderThickness: =1
                                          Fill: =Switch(ThisItem.Severity, "Critical", gblTheme.ErrorLight, "High", gblTheme.WarningLight, gblTheme.Surface)
                                          Height: =Parent.TemplateHeight - 4
                                          Width: =Parent.Width - 8
                                          X: =4
                                          Y: =2
                                    - txtHazardDescription:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =14 * gblDevice.FontScale
                                          Height: =50
                                          OnChange: |-
                                            =Patch(
                                                                                            colFindings,
                                                                                            LookUp(colFindings, FindingID = ThisItem.FindingID),
                                                                                            {Issue: "Other hazard: " & Self.Value}
                                                                                        );
                                          Placeholder: ="Describe hazard..."
                                          Value: =Mid(ThisItem.Issue, 15)
                                          Width: =Parent.Width - 200
                                          X: =20
                                          Y: =15
                                    - togHazardDanger:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Default: =ThisItem.Severity = "Critical"
                                          FalseText: ="Medium"
                                          Height: =40
                                          OnCheck: |-
                                            =Patch(
                                                colFindings,
                                                LookUp(colFindings, FindingID = ThisItem.FindingID),
                                                {Severity: "Critical"}
                                            );
                                            Select(btnRecalculateScore);
                                          OnUncheck: |-
                                            =Patch(
                                                colFindings,
                                                LookUp(colFindings, FindingID = ThisItem.FindingID),
                                                {Severity: "Minor"}
                                            );
                                            Select(btnRecalculateScore);
                                          TrueFill: =gblTheme.Error
                                          TrueText: ="Critical"
                                          Width: =100
                                          X: =Parent.Width - 180
                                          Y: =15
                                    - icoHazardDelete:
                                        Control: Classic/Icon@2.5.0
                                        Properties:
                                          Color: =gblTheme.Error
                                          Height: =30
                                          Icon: =Icon.Trash
                                          OnSelect: |-
                                            =Remove(colFindings, ThisItem);
                                            RemoveIf(colFindingPhotos, FindingID = ThisItem.FindingID);
                                            Select(btnRecalculateScore);
                                            Notify("Hazard removed", NotificationType.Information);
                                          Width: =30
                                          X: =Parent.Width - 60
                                          Y: =25
                              - btnAddHazard:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    Color: =gblTheme.TextPrimary
                                    Fill: =gblTheme.Warning
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =50
                                    OnSelect: |-
                                      =Collect(
                                          colFindings,
                                          {
                                              FindingID: GUID(),
                                              Issue: "Other hazard: [Describe hazard]",
                                              Severity: "Minor",
                                              Category: "Site Conditions",
                                              SubCategory: "Other Hazards",
                                              SpecificIssue: "Other Hazard",
                                              RootCause: "Site Issue",
                                              QuickFix: "Address hazard",
                                              Notes: "",
                                              Photos: Table(),
                                              Timestamp: Now(),
                                              AuditStep: 4
                                          }
                                      );
                                      Notify("Hazard added - edit details in Step 5", NotificationType.Information, 2000);
                                      Select(btnRecalculateScore);
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: ="+ Add Hazard"
                                    Width: =180
                                    X: =Parent.Width - 200
                                    Y: =20
                        - lblStep4Progress_1:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =gblTheme.TextTertiary
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              Size: =12 * gblDevice.FontScale
                              Text: |-
                                =Switch(locCurrentAuditStep,
                                      1, CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title)) & " permits reviewed",
                                      2, "Systems check " & If(togPotableWater.Value || togBackflow.Value, "in progress", "pending"),
                                      3, CountRows(colInventories) & " items inventoried",
                                      4, CountRows(Filter(colFindings, AuditStep = 4)) & " conditions documented",
                                      5, CountRows(colFindings) & " total findings to review"
                                    )
                              Width: =230
                              X: =Parent.Width - 250
                              Y: =50
                  - conStep3_Inventories:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =1
                        Fill: =gblTheme.Surface
                        Height: =650
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Visible: |+
                          =true
                        Width: =Parent.Width
                        Y: '=20 '
                      Children:
                        - lblInventoriesTitle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextSecondary
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Bold
                              Size: =20 * gblDevice.FontScale
                              Text: |-
                                ="📦 Inventories & Storage"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =20
                        - galInventoryTabs:
                            Control: Gallery@2.15.0
                            Variant: BrowseLayout_Horizontal_TwoTextOneImageVariant_ver5.0
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Height: =80
                              Items: |-
                                =Table(
                                    {Tab: "Chemicals", Icon: Icon.Search, Color: gblTheme.Primary},
                                    {Tab: "Wastes", Icon: Icon.Trash, Color: gblTheme.Warning},
                                    {Tab: "Tanks", Icon: Icon.HalfFilledCircle, Color: gblTheme.Accent}
                                )
                              ShowScrollbar: =false
                              TemplateSize: =Parent.Width / 3
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =70
                            Children:
                              - btnInvTab:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    BorderThickness: =1
                                    Color: =If(ThisItem.Tab = varSelectedInventoryTab, gblTheme.TextPrimary, gblTheme.TextSecondary)
                                    Fill: =If(ThisItem.Tab = varSelectedInventoryTab, ThisItem.Color, gblTheme.Surface)
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =If(ThisItem.Tab = varSelectedInventoryTab, FontWeight.Bold, FontWeight.Normal)
                                    Height: =Parent.TemplateHeight - 4
                                    HoverFill: =ColorFade(ThisItem.Color, -10%)
                                    OnSelect: =Set(varSelectedInventoryTab, ThisItem.Tab)
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: =ThisItem.Tab
                                    Width: =Parent.TemplateWidth - 4
                                    X: =2
                                    Y: =2
                        - conWastes:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =650
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedInventoryTab = "Wastes"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblWastesTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="🗑️ Waste Management"
                                    Width: =Parent.Width - 220
                                    X: =20
                                    Y: =20
                              - galWastes:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderThickness: =1
                                    Height: =500
                                    Items: =Filter(colInventories, InventoryType = "Waste")
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =80
                                  Children:
                                    - recWasteBg:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =If(ThisItem.MaterialStatus = "Hazardous", gblTheme.Warning, gblTheme.BorderLight)
                                          BorderThickness: =If(ThisItem.MaterialStatus = "Hazardous", 2, 1)
                                          Fill: =If(ThisItem.MaterialStatus = "Hazardous", gblTheme.WarningLight, gblTheme.Surface)
                                          Height: =Parent.TemplateHeight - 4
                                          Width: =Parent.Width - 8
                                          X: =4
                                          Y: =2
                                    - ddWasteType:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Default: =ThisItem.MaterialType
                                          Font: =Font.'Segoe UI'
                                          Height: =50
                                          Items: =["FOG", "Used Oil", "Hazardous", "Medical", "E-Waste", "Universal"]
                                          Items.Value: =Value
                                          OnChange: |-
                                            =Patch(
                                                colInventories,
                                                LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                {
                                                    MaterialType: Self.Selected.Value,
                                                    MaterialStatus: If(Self.Selected.Value in ["Hazardous", "Medical"], "Hazardous", "Non-Hazardous")
                                                }
                                            );
                                            If(
                                                Self.Selected.Value in ["Hazardous", "Medical"],
                                                Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "Special waste: " & Self.Selected.Value,
                                                        Severity: "High",
                                                        Category: "Waste Management",
                                                        SubCategory: "Hazardous Waste",
                                                        SpecificIssue: "Special Waste",
                                                        RootCause: "Regulated Waste",
                                                        QuickFix: "Ensure proper handling and disposal",
                                                        Notes: "",
                                                        Photos: [],
                                                        Timestamp: Now(),
                                                        AuditStep: 3
                                                    }
                                                );
                                                Notify("Special waste flagged - review in Step 5", NotificationType.Information, 2000);
                                            );
                                          Size: =14 * gblDevice.FontScale
                                          Width: =150
                                          X: =20
                                          Y: =20
                                    - txtWasteDescription:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =14 * gblDevice.FontScale
                                          Height: =50
                                          OnChange: |-
                                            =Patch(
                                                                                            colInventories,
                                                                                            LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                                                            {Title: Self.Value}
                                                                                        );
                                          Placeholder: ="Waste description"
                                          Value: =ThisItem.Title
                                          Width: =200
                                          X: =190
                                          Y: =20
                                    - txtWasteAmount:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Height: =50
                                          OnChange: |-
                                            =Patch(
                                                                                            colInventories,
                                                                                            LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                                                            {Quantity: Value(Self.Value)}
                                                                                        );
                                          Placeholder: ="Amount"
                                          Value: =Text(ThisItem.Quantity)
                                          Width: =80
                                          X: =20
                                          Y: =90
                                    - ddWasteContainer:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Default: =ThisItem.Container
                                          Font: =Font.'Segoe UI'
                                          Height: =50
                                          Items: =["Drum", "Tote", "Box", "Bag", "Other"]
                                          Items.Value: =Value
                                          OnChange: |-
                                            =Patch(
                                                colInventories,
                                                LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                {Container: Self.Selected.Value}
                                            );
                                          Size: =14 * gblDevice.FontScale
                                          Width: =100
                                          X: =120
                                          Y: =90
                                    - lblWasteProper:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: =gblTheme.TextTertiary
                                          Font: =Font.'Segoe UI'
                                          Height: =20
                                          Size: =12 * gblDevice.FontScale
                                          Text: ="Storage OK?"
                                          Width: =100
                                          X: =240
                                          Y: =60
                                    - togWasteProper:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Default: =ThisItem.ProperStorage
                                          FalseText: ="Improper"
                                          Height: =50
                                          OnUncheck: |
                                            =Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "Improper waste storage: " & ThisItem.Title,
                                                        Severity: "Major",  // Changed from Critical
                                                        Category: "Waste Management",
                                                        SubCategory: "Storage",
                                                        SpecificIssue: "Improper Storage",
                                                        RootCause: "Storage Issue",
                                                        QuickFix: "Correct waste storage conditions",
                                                        Notes: "",
                                                        Photos: Table(),
                                                        Timestamp: Now(),
                                                        AuditStep: 3
                                                    }
                                                );
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Proper"
                                          Width: =100
                                          X: =240
                                          Y: =90
                                    - icoWasteDelete:
                                        Control: Classic/Icon@2.5.0
                                        Properties:
                                          Color: =gblTheme.Error
                                          Height: =30
                                          Icon: =Icon.Trash
                                          OnSelect: |-
                                            =Remove(colInventories, ThisItem);
                                            Notify("Waste item removed", NotificationType.Information);
                                          Width: =30
                                          X: =Parent.Width - 50
                                          Y: =60
                              - btnAddWaste:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    Color: =gblTheme.TextPrimary
                                    Fill: =gblTheme.Success
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =50
                                    OnSelect: |-
                                      =Collect(
                                          colInventories,
                                          {
                                              InventoryID: GUID(),
                                              InventoryType: "Waste",
                                              Title: "",
                                              MaterialType: "FOG",
                                              MaterialStatus: "Non-Hazardous",
                                              MaterialCategory: "Waste",
                                              Quantity: 0,
                                              QuantityUnit: "Gallons",
                                              ProperStorage: true,
                                              Labeled: true,
                                              Container: "Drum",
                                              Comments: ""
                                          }
                                      );
                                      Notify("New waste item added", NotificationType.Success);
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: ="+ Add Waste"
                                    Width: =180
                                    X: =Parent.Width - 200
                                    Y: =20
                        - conTanks:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =575
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedInventoryTab = "Tanks"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: |+
                                =20
                            Children:
                              - lblTanksTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="🛢️ Tank Inventory"
                                    Width: =Parent.Width - 220
                                    X: =20
                                    Y: =20
                              - galTanks:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderThickness: =1
                                    Height: =480
                                    Items: =Filter(colInventories, InventoryType = "Tank")
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =80
                                  Children:
                                    - recTankBg:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =If(ThisItem.Condition = "Poor", gblTheme.Error, If(ThisItem.Condition = "Fair", gblTheme.Warning, gblTheme.BorderLight))
                                          BorderThickness: =If(ThisItem.Condition = "Good", 1, 2)
                                          Fill: =If(ThisItem.Condition = "Poor", gblTheme.ErrorLight, If(ThisItem.Condition = "Fair", gblTheme.WarningLight, gblTheme.Surface))
                                          Width: =Parent.Width - 8
                                          X: =4
                                          Y: =2
                                    - ddTankType:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Default: =ThisItem.TankType
                                          Font: =Font.'Segoe UI'
                                          Height: =50
                                          Items: =["AST", "UST", "Day Tank", "Portable"]
                                          Items.Value: =Value
                                          OnChange: |-
                                            =Patch(
                                                colInventories,
                                                LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                {TankType: Self.Selected.Value}
                                            );
                                          Size: =14 * gblDevice.FontScale
                                          Width: =120
                                          X: =20
                                          Y: =20
                                    - txtTankContents:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =14 * gblDevice.FontScale
                                          Height: =50
                                          OnChange: |-
                                            =Patch(
                                                                                            colInventories,
                                                                                            LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                                                            {Title: Self.Value}
                                                                                        );
                                          Placeholder: ="Tank contents"
                                          Value: =ThisItem.Title
                                          Width: =180
                                          X: =160
                                          Y: =20
                                    - txtTankCapacity:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =14 * gblDevice.FontScale
                                          Height: =50
                                          OnChange: |-
                                            =Patch(
                                                                                            colInventories,
                                                                                            LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                                                            {Capacity: Value(Self.Value)}
                                                                                        );
                                          Placeholder: ="Capacity (gal)"
                                          Value: =Text(ThisItem.Capacity)
                                          Width: =120
                                          X: =20
                                          Y: =90
                                    - lblTankContainment:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: =gblTheme.TextTertiary
                                          Font: =Font.'Segoe UI'
                                          Height: =20
                                          Size: =12 * gblDevice.FontScale
                                          Text: ="Secondary Containment?"
                                          Width: =120
                                          X: =160
                                          Y: =70
                                    - togTankContainment:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Default: =ThisItem.SecondaryContainment
                                          FalseText: ="No"
                                          Height: =50
                                          OnUncheck: |-
                                            =Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "No secondary containment: " & ThisItem.Title & " tank",
                                                        Severity: "Major",  // Changed from Critical
                                                        Category: "Tank Management",
                                                        SubCategory: "Secondary Containment",
                                                        SpecificIssue: "Missing Containment",
                                                        RootCause: "Equipment Issue",
                                                        QuickFix: "Install secondary containment",
                                                        Notes: "",
                                                        Photos: Table(),
                                                        Timestamp: Now(),
                                                        AuditStep: 3
                                                    }
                                                );
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =80
                                          X: =160
                                          Y: =90
                                    - lblTankInspected:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: =gblTheme.TextTertiary
                                          Font: =Font.'Segoe UI'
                                          Height: =20
                                          Size: =12 * gblDevice.FontScale
                                          Text: ="Recently Inspected?"
                                          Width: =120
                                          X: =300
                                          Y: =70
                                    - togTankInspected:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Default: =ThisItem.Inspected
                                          FalseText: ="No"
                                          Height: =50
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "Tank not inspected: " & ThisItem.Title,
                                                    Severity: "Minor",
                                                    Category: "Tank Management",
                                                    SubCategory: "Inspection",
                                                    SpecificIssue: "Missing Inspection",
                                                    RootCause: "Maintenance Issue",
                                                    QuickFix: "Schedule tank inspection",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 3
                                                }
                                            );
                                            Patch(
                                                colInventories,
                                                LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                {Inspected: false}
                                            );
                                            Notify("Tank inspection issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =80
                                          X: =300
                                          Y: =90
                                    - lblTankCondition:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          Color: =gblTheme.TextTertiary
                                          Font: =Font.'Segoe UI'
                                          Height: =20
                                          Size: =12 * gblDevice.FontScale
                                          Text: ="Condition"
                                          Width: =100
                                          X: =440
                                          Y: =70
                                    - ddTankCondition:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Default: =ThisItem.Condition
                                          Font: =Font.'Segoe UI'
                                          Height: =50
                                          Items: =["Good", "Fair", "Poor"]
                                          Items.Value: =Value
                                          OnChange: |-
                                            =Patch(
                                                colInventories,
                                                LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                {Condition: Self.Selected.Value}
                                            );
                                            If(
                                                Self.Selected.Value = "Poor",
                                                Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "Tank in poor condition: " & ThisItem.Title,
                                                        Severity: "High",
                                                        Category: "Tank Management",
                                                        SubCategory: "Condition",
                                                        SpecificIssue: "Poor Condition",
                                                        RootCause: "Deterioration",
                                                        QuickFix: "Repair or replace tank",
                                                        Notes: "",
                                                        Photos: [],
                                                        Timestamp: Now(),
                                                        AuditStep: 3
                                                    }
                                                );
                                                Notify("Tank condition issue flagged - review in Step 5", NotificationType.Information, 2000);
                                            );
                                          Size: =14 * gblDevice.FontScale
                                          Width: =80
                                          X: =440
                                          Y: =90
                                    - icoTankDelete:
                                        Control: Classic/Icon@2.5.0
                                        Properties:
                                          Color: =gblTheme.Error
                                          Height: =30
                                          Icon: =Icon.Trash
                                          OnSelect: |-
                                            =Remove(colInventories, ThisItem);
                                            Notify("Tank removed", NotificationType.Information);
                                          Width: =30
                                          X: =Parent.Width - 50
                                          Y: =60
                              - btnAddTank:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    Color: =gblTheme.TextPrimary
                                    Fill: =gblTheme.Success
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =50
                                    OnSelect: |-
                                      =Collect(
                                          colInventories,
                                          {
                                              InventoryID: GUID(),
                                              InventoryType: "Tank",
                                              Title: "",
                                              TankType: "AST",
                                              Capacity: 0,
                                              SecondaryContainment: true,
                                              Inspected: true,
                                              Condition: "Good"
                                          }
                                      );
                                      Notify("New tank added", NotificationType.Success);
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: ="+ Add Tank"
                                    Width: =180
                                    X: =Parent.Width - 200
                                    Y: =15
                        - conChemicals:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =If(gblDevice.IsPhone, 550, 480)
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedInventoryTab = "Chemicals"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblChemicalSearch:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="🔍 Search or Add Chemical:"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - cbChemicalSearch:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    DisplayFields: =["Title"]
                                    Font: =Font.'Segoe UI'
                                    Height: =60
                                    InputTextPlaceholder: ="Type to search chemicals..."
                                    Items: =Sort(colChemicalProducts, Title, SortOrder.Ascending)
                                    OnChange: =Set(varManualChemical, "")
                                    SearchFields: =["Title","Brand"]
                                    Size: =14 * gblDevice.FontScale
                                    Width: =If(gblDevice.IsPhone, Parent.Width - 40, Parent.Width - 240)
                                    X: =20
                                    Y: =60
                              - txtManualChemical:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    Font: =Font.'Segoe UI'
                                    Height: =60
                                    HintText: ="Chemical not found? Enter name here"
                                    Size: =14 * gblDevice.FontScale
                                    Visible: =IsBlank(cbChemicalSearch.Selected)
                                    Width: =If(gblDevice.IsPhone, Parent.Width - 40, Parent.Width - 240)
                                    X: =20
                                    Y: =130
                              - btnAddToInventory:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    Color: =gblTheme.TextPrimary
                                    DisplayMode: =If(IsBlank(cbChemicalSearch.Selected) && IsBlank(txtManualChemical.Text), DisplayMode.Disabled, DisplayMode.Edit)
                                    Fill: =gblTheme.Success
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =60
                                    OnSelect: |-
                                      =Collect(
                                          colInventories,
                                          {
                                              InventoryID: GUID(),
                                              InventoryType: "Chemical",
                                              Title: Coalesce(cbChemicalSearch.Selected.Title, txtManualChemical.Text),
                                              ChemicalProduct: cbChemicalSearch.Selected,
                                              Quantity: 0,
                                              QuantityUnit: "gallons",
                                              ProperStorage: true,
                                              Labeled: true,
                                              MSDSAvailable: true
                                          }
                                      );
                                      Notify("Chemical added to inventory", NotificationType.Success);
                                      Reset(cbChemicalSearch);
                                      Reset(txtManualChemical);
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: ="+ Add to Inventory"
                                    Width: =If(gblDevice.IsPhone, Parent.Width - 40, 180)
                                    X: =If(gblDevice.IsPhone, 20, Parent.Width - 200)
                                    Y: =If(gblDevice.IsPhone, 200, 60)
                              - lblChemicalInventory:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="📋 Current Chemical Inventory:"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =If(gblDevice.IsPhone, 270, 200)
                              - galChemicals:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderThickness: =1
                                    Height: =If(gblDevice.IsPhone, 200, 220)
                                    Items: =Filter(colInventories, InventoryType = "Chemical")
                                    TemplatePadding: =4
                                    TemplateSize: =If(gblDevice.IsPhone, 120, 80)
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =If(gblDevice.IsPhone, 310, 240)
                                  Children:
                                    - recChemBg:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =gblTheme.BorderLight
                                          BorderThickness: =1
                                          Fill: =gblTheme.Surface
                                          Height: =Parent.TemplateHeight - 4
                                          Width: =Parent.Width - 8
                                          Y: =2
                                    - lblChemTitle:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =25
                                          Size: =If(gblDevice.IsPhone, 12, 14) * gblDevice.FontScale
                                          Text: =ThisItem.Title
                                          Width: =If(gblDevice.IsPhone, Parent.Width - 100, 300)
                                          X: =10
                                          Y: =If(gblDevice.IsPhone, 5, 10)
                                    - conChemControls:
                                        Control: GroupContainer@1.3.0
                                        Variant: ManualLayout
                                        Properties:
                                          Height: =If(gblDevice.IsPhone, 80, 50)
                                          Width: =Parent.Width - 20
                                          X: =10
                                          Y: =30
                                        Children:
                                          - txtChemQuantity:
                                              Control: Classic/TextInput@2.3.2
                                              Properties:
                                                BorderColor: =gblTheme.Border
                                                Default: =Text(ThisItem.Quantity)
                                                Font: =Font.'Segoe UI'
                                                HintText: ="Qty"
                                                OnChange: |-
                                                  =Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {Quantity: Value(Self.Text)}
                                                  )
                                                Size: =12 * gblDevice.FontScale
                                                Width: =If(gblDevice.IsPhone, 60, 80)
                                          - ddChemUnit:
                                              Control: Classic/DropDown@2.3.1
                                              Properties:
                                                BorderColor: =gblTheme.Border
                                                Default: =ThisItem.QuantityUnit
                                                Font: =Font.'Segoe UI'
                                                Items: =["gallons", "pounds", "liters", "kg", "each"]
                                                Items.Value: =Value
                                                OnChange: |-
                                                  =Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {QuantityUnit: Self.Selected.Value}
                                                  )
                                                Size: =12 * gblDevice.FontScale
                                                Width: =If(gblDevice.IsPhone, 80, 100)
                                                X: =If(gblDevice.IsPhone, 70, 90)
                                          - togChemStorage:
                                              Control: Classic/Toggle@2.1.0
                                              Properties:
                                                Color: =gblTheme.TextSecondary
                                                Default: =ThisItem.ProperStorage
                                                FalseText: ="Storage?"
                                                Height: =40
                                                OnCheck: |-
                                                  =RemoveIf(
                                                      colFindings,
                                                      Issue = "Improper storage: " & ThisItem.Title
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {ProperStorage: true}
                                                  );
                                                  Select(btnRecalculateScore);
                                                OnUncheck: |-
                                                  =Collect(
                                                      colFindings,
                                                      {
                                                          FindingID: GUID(),
                                                          Issue: "Improper storage: " & ThisItem.Title,
                                                          Severity: "Minor",
                                                          MajorType: "",
                                                          Category: "Chemical Storage",
                                                          SubCategory: "Storage",
                                                          SpecificIssue: "Improper Storage",
                                                          RootCause: "Storage Issue",
                                                          QuickFix: "Correct storage conditions",
                                                          Notes: "",
                                                          FixedOnSite: false,
                                                          Photos: Table(),
                                                          Timestamp: Now(),
                                                          AuditStep: 3
                                                      }
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {ProperStorage: false}
                                                  );
                                                  Select(btnRecalculateScore);
                                                TrueFill: =gblTheme.Success
                                                TrueText: ="OK"
                                                Width: =If(gblDevice.IsPhone, 70, 80)
                                                X: =If(gblDevice.IsPhone, 160, 200)
                                                Y: =If(gblDevice.IsPhone, 0, 0)
                                          - togChemLabeled:
                                              Control: Classic/Toggle@2.1.0
                                              Properties:
                                                Color: =gblTheme.TextSecondary
                                                Default: =ThisItem.Labeled
                                                FalseText: ="Label?"
                                                Height: =40
                                                OnCheck: |-
                                                  =RemoveIf(
                                                      colFindings,
                                                      Issue = "Not labeled: " & ThisItem.Title
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {Labeled: true}
                                                  );
                                                  Select(btnRecalculateScore);
                                                OnUncheck: |-
                                                  =Collect(
                                                      colFindings,
                                                      {
                                                          FindingID: GUID(),
                                                          Issue: "Not labeled: " & ThisItem.Title,
                                                          Severity: "Observation",
                                                          MajorType: "",
                                                          Category: "Chemical Storage",
                                                          SubCategory: "Labeling",
                                                          SpecificIssue: "Missing Label",
                                                          RootCause: "Labeling Issue",
                                                          QuickFix: "Add proper labeling",
                                                          Notes: "",
                                                          FixedOnSite: false,
                                                          Photos: Table(),
                                                          Timestamp: Now(),
                                                          AuditStep: 3
                                                      }
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {Labeled: false}
                                                  );
                                                  Select(btnRecalculateScore);
                                                TrueFill: =gblTheme.Success
                                                TrueText: ="OK"
                                                Width: =If(gblDevice.IsPhone, 70, 80)
                                                X: =If(gblDevice.IsPhone, 240, 290)
                                                Y: =If(gblDevice.IsPhone, 0, 0)
                                          - togChemMSDS:
                                              Control: Classic/Toggle@2.1.0
                                              Properties:
                                                Color: =gblTheme.TextSecondary
                                                Default: =ThisItem.MSDSAvailable
                                                FalseText: ="MSDS?"
                                                Height: =40
                                                OnCheck: |-
                                                  =RemoveIf(
                                                      colFindings,
                                                      Issue = "No MSDS: " & ThisItem.Title
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {MSDSAvailable: true}
                                                  );
                                                  Select(btnRecalculateScore);
                                                OnUncheck: |-
                                                  =Collect(
                                                      colFindings,
                                                      {
                                                          FindingID: GUID(),
                                                          Issue: "No MSDS: " & ThisItem.Title,
                                                          Severity: "Minor",
                                                          MajorType: "",
                                                          Category: "Chemical Storage",
                                                          SubCategory: "Documentation",
                                                          SpecificIssue: "Missing MSDS",
                                                          RootCause: "Documentation Issue",
                                                          QuickFix: "Obtain MSDS sheet",
                                                          Notes: "",
                                                          FixedOnSite: false,
                                                          Photos: Table(),
                                                          Timestamp: Now(),
                                                          AuditStep: 3
                                                      }
                                                  );
                                                  Patch(
                                                      colInventories,
                                                      LookUp(colInventories, InventoryID = ThisItem.InventoryID),
                                                      {MSDSAvailable: false}
                                                  );
                                                  Select(btnRecalculateScore);
                                                TrueFill: =gblTheme.Success
                                                TrueText: ="OK"
                                                Visible: =!gblDevice.IsPhone
                                                Width: =80
                                                X: =380
                                          - icoChemDelete:
                                              Control: Classic/Icon@2.5.0
                                              Properties:
                                                Color: =gblTheme.Error
                                                Height: =30
                                                Icon: =Icon.Trash
                                                OnSelect: |-
                                                  =Remove(colInventories, ThisItem);
                                                  Notify("Chemical removed", NotificationType.Information);
                                                Width: =30
                                                X: =If(gblDevice.IsPhone, Parent.Width - 40, Parent.Width - 50)
                                                Y: =5
                        - lblStep3Progress_1:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =gblTheme.TextTertiary
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              Size: =12 * gblDevice.FontScale
                              Text: |-
                                =Switch(locCurrentAuditStep,
                                      1, CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title)) & " permits reviewed",
                                      2, "Systems check " & If(togPotableWater.Value || togBackflow.Value, "in progress", "pending"),
                                      3, CountRows(colInventories) & " items inventoried",
                                      4, CountRows(Filter(colFindings, AuditStep = 4)) & " conditions documented",
                                      5, CountRows(colFindings) & " total findings to review"
                                    )
                              Width: =230
                              X: =Parent.Width - 250
                              Y: =50
                  - conStep2_Systems:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =1
                        Fill: =gblTheme.Surface
                        Height: =650
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Visible: |+
                          =true
                        Width: =Parent.Width
                        Y: =20
                      Children:
                        - lblSystemsTitle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextSecondary
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Bold
                              Size: =20 * gblDevice.FontScale
                              Text: |-
                                ="🔧 On-Site Systems Review"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =20
                        - galSystemsTabs:
                            Control: Gallery@2.15.0
                            Variant: BrowseLayout_Horizontal_TwoTextOneImageVariant_ver5.0
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Height: =80
                              Items: |-
                                =Table(
                                    {Tab: "Water", Icon: Icon.Filter, Color: gblTheme.Accent},
                                    {Tab: "Odors", Icon: Icon.Warning, Color: gblTheme.Warning}
                                )
                              ShowScrollbar: =false
                              TemplateSize: =Parent.Width / 2
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =70
                            Children:
                              - btnTab:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    BorderThickness: =1
                                    Color: =If(ThisItem.Tab = varSelectedSystemTab, gblTheme.TextPrimary, gblTheme.TextSecondary)
                                    Fill: =If(ThisItem.Tab = varSelectedSystemTab, ThisItem.Color, gblTheme.Surface)
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =If(ThisItem.Tab = varSelectedSystemTab, FontWeight.Bold, FontWeight.Normal)
                                    Height: =Parent.TemplateHeight - 4
                                    HoverFill: =ColorFade(ThisItem.Color, -10%)
                                    OnSelect: =Set(varSelectedSystemTab, ThisItem.Tab)
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =16 * gblDevice.FontScale
                                    Text: =ThisItem.Tab
                                    Width: =Parent.TemplateWidth-4
                                    X: =2
                                    Y: =2
                        - conStorageSystems:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =550
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedSystemTab = "Storage"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblStorageTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="📦 Chemical Storage & Containment"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - conSecondaryContainment:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =70
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =60
                                  Children:
                                    - lblSecondaryContainment:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Secondary Containment Present?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togSecondaryContainment:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnCheck: |-
                                            =RemoveIf(
                                                colFindings,
                                                Issue = "No secondary containment"
                                            );
                                            Select(btnRecalculateScore);
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "No secondary containment",
                                                    Severity: "Major",
                                                    MajorType: "Health/Environmental",
                                                    Category: "Chemical Storage",
                                                    SubCategory: "Containment",
                                                    SpecificIssue: "Missing Secondary Containment",
                                                    RootCause: "Infrastructure Issue",
                                                    DetailedDescription: "Chemical storage area lacks secondary containment system required for spill prevention",
                                                    Location: "Chemical storage area",
                                                    RequirementViolated: "SPCC Plan / 40 CFR 112",
                                                    CorrectiveAction: "Install secondary containment system (berms, pallets, or containment structures)",
                                                    ResponsibleParty: "",
                                                    DueDate: DateAdd(Today(), 60),
                                                    FixedOnSite: false,
                                                    FixedDescription: "",
                                                    FollowUpRequired: true,
                                                    AuditorNotes: "",
                                                    FacilityResponse: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 2
                                                }
                                            );
                                            Select(btnRecalculateScore);
                                            Notify("Storage finding added", NotificationType.Information, 2000)
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =15
                              - conChemicalLabeling:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =70
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =140
                                  Children:
                                    - lblChemicalLabeling:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="All Chemicals Properly Labeled?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togChemicalLabeling:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnCheck: |-
                                            =RemoveIf(
                                                colFindings,
                                                Issue = "Unlabeled chemical containers"
                                            );
                                            Select(btnRecalculateScore);
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "Unlabeled chemical containers",
                                                    Severity: "Minor",
                                                    MajorType: "",
                                                    Category: "Chemical Storage",
                                                    SubCategory: "Labeling",
                                                    SpecificIssue: "Missing Labels",
                                                    RootCause: "Housekeeping",
                                                    DetailedDescription: "Chemical containers found without proper identification labels",
                                                    Location: "Chemical storage area",
                                                    RequirementViolated: "OSHA Hazard Communication Standard / GHS",
                                                    CorrectiveAction: "Label all chemical containers with product name and hazard information",
                                                    ResponsibleParty: "",
                                                    DueDate: DateAdd(Today(), 7),
                                                    FixedOnSite: false,
                                                    FixedDescription: "",
                                                    FollowUpRequired: false,
                                                    AuditorNotes: "",
                                                    FacilityResponse: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 2
                                                }
                                            );
                                            Select(btnRecalculateScore);
                                            Notify("Labeling finding added", NotificationType.Information, 2000)
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =15
                              - conContainerIntegrity:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =70
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =220
                                  Children:
                                    - lblContainerIntegrity:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Container Integrity Good?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togContainerIntegrity:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =15
                              - txtStorageNotes:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    BorderThickness: =1
                                    Color: =gblTheme.TextSecondary
                                    Fill: =gblTheme.Surface
                                    Font: =Font.'Segoe UI'
                                    Height: =160
                                    HintText: ="Secondary containment condition, container integrity details, labeling issues, spill response equipment availability, storage organization, incompatible materials separation, etc."
                                    HoverBorderColor: =gblTheme.Primary
                                    Mode: =TextMode.MultiLine
                                    OnChange: =Set(gblStorageNotes, Self.Text)
                                    PaddingBottom: =8
                                    PaddingLeft: =8
                                    PaddingRight: =8
                                    PaddingTop: =8
                                    Size: =14 * gblDevice.FontScale
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =300
                              - lblStorageNotesHelper:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextTertiary
                                    Font: =Font.'Segoe UI'
                                    Height: =60
                                    Size: =12 * gblDevice.FontScale
                                    Text: ="Document storage area conditions, specific container issues, SPCC plan compliance, emergency response equipment present, etc."
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =470
                        - conAirSystems:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =450
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedSystemTab = "Air"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblAirSystemsTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="🌫️ Air Quality & Emissions Assessment"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - conGenerators:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =70
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =60
                                  Children:
                                    - lblGenerators:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Emergency Generators Present?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togGenerators:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =15
                              - conAirPermit_1:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =70
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =140
                                  Children:
                                    - lblAirPermit_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Title V Air Permit Required?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togAirPermit:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnCheck: |-
                                            =RemoveIf(
                                                colFindings,
                                                Issue = "Title V air permit missing"
                                            );
                                            Select(btnRecalculateScore);
                                          OnUncheck: |-
                                            =If(
                                                togGenerators.Value,
                                                Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "Title V air permit missing",
                                                        Severity: "Major",
                                                        MajorType: "Sovereignty",
                                                        Category: "Air Quality",
                                                        SubCategory: "Permits",
                                                        SpecificIssue: "Missing Air Permit",
                                                        RootCause: "Regulatory Compliance",
                                                        DetailedDescription: "Facility has emergency generators but no Title V air permit on file",
                                                        Location: "Generator area",
                                                        RequirementViolated: "Clean Air Act Title V",
                                                        CorrectiveAction: "Apply for Title V air permit or verify exemption status",
                                                        ResponsibleParty: "",
                                                        DueDate: DateAdd(Today(), 30),
                                                        FixedOnSite: false,
                                                        FixedDescription: "",
                                                        FollowUpRequired: true,
                                                        AuditorNotes: "",
                                                        FacilityResponse: "",
                                                        Photos: Table(),
                                                        Timestamp: Now(),
                                                        AuditStep: 2
                                                    }
                                                );
                                                Select(btnRecalculateScore);
                                                Notify("Air permit finding added", NotificationType.Information, 2000)
                                            )
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =15
                              - txtAirSystemNotes:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    BorderThickness: =1
                                    Color: =gblTheme.TextSecondary
                                    Fill: =gblTheme.Surface
                                    Font: =Font.'Segoe UI'
                                    Height: =160
                                    HintText: ="Generator runtime observations, visible emissions, air permit compliance notes, odor observations from air systems, other air quality notes..."
                                    HoverBorderColor: =gblTheme.PrimaryDark
                                    Mode: =TextMode.MultiLine
                                    OnChange: =Set(gblAirSystemNotes, Self.Text)
                                    PaddingBottom: =8
                                    PaddingLeft: =8
                                    PaddingRight: =8
                                    PaddingTop: =8
                                    Size: =14 * gblDevice.FontScale
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =220
                              - lblAirNotesHelper:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextTertiary
                                    Font: =Font.'Segoe UI'
                                    Size: =12 * gblDevice.FontScale
                                    Text: ="Document generator conditions, emissions visible, operating hours, maintenance records reviewed, etc."
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =390
                        - conWaterSystems:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =400
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedSystemTab = "Water"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblWaterSystemsTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="💧 Water Systems Assessment"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - conPotableWater:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =120
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =60
                                  Children:
                                    - txtWaterSystemNotes:
                                        Control: Classic/TextInput@2.3.2
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Font: =Font.'Segoe UI'
                                          Height: =100
                                          HintText: ="Additional water system observations, NPDES permit notes, outfall conditions, discharge observations..."
                                          Mode: =TextMode.MultiLine
                                          Size: =14 * gblDevice.FontScale
                                          Width: =Parent.Width - 40
                                          X: =40
                                          Y: =20
                                    - lblPotableWater:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Potable Water System Present?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togPotableWater:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =20
                              - conBackflow:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =120
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =180
                                  Children:
                                    - lblBackflow:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Backflow Prevention in Place?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togBackflow:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "No backflow prevention",
                                                    Severity: "Minor",
                                                    Category: "Water Systems",
                                                    SubCategory: "Potable Water",
                                                    SpecificIssue: "Backflow Prevention",
                                                    RootCause: "Missing Equipment",
                                                    QuickFix: "Install backflow prevention device",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 2
                                                }
                                            );
                                            Notify("Water system issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =20
                              - conWastewater:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =120
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =300
                                  Children:
                                    - lblWastewater:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =60
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Wastewater System Type:"
                                          Width: =268
                                          X: =30
                                          Y: =25
                                    - ddWastewaterType:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Font: =Font.'Segoe UI'
                                          Height: =60
                                          Items: =["Municipal Sewer", "Septic System", "Other"]
                                          Items.Value: =Value
                                          Size: =16 * gblDevice.FontScale
                                          Width: =200
                                          X: =298
                                          Y: =25
                                    - lblSepticInspected:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Septic System Inspected?"
                                          Visible: =ddWastewaterType.Selected.Value = "Septic System"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =90
                                    - togSepticInspected:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "Septic not inspected",
                                                    Severity: "Minor",
                                                    Category: "Water Systems",
                                                    SubCategory: "Wastewater",
                                                    SpecificIssue: "Septic Inspection",
                                                    RootCause: "Maintenance Issue",
                                                    QuickFix: "Schedule septic inspection",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 2
                                                }
                                            );
                                            Notify("Septic issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Visible: =ddWastewaterType.Selected.Value = "Septic System"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =85
                        - conGreaseTraps:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Height: =150
                              Visible: =!IsEmpty(Filter(colGreaseTraps, 'Facility Name'.Value = gblSelectedFacility.Title))
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =580
                            Children:
                              - lblGreaseTraps:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =16 * gblDevice.FontScale
                                    Text: |-
                                      ="🍽️ Grease Trap Service History:"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - galGreaseTraps:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_TwoTextVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderThickness: =1
                                    Height: =100
                                    Items: =Filter(colGreaseTraps, 'Facility Name'.Value = gblSelectedFacility.Title)
                                    Width: =Parent.Width - 40
                                    X: =20
                                  Children:
                                    - recGreaseBg:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =gblTheme.BorderLight
                                          BorderThickness: =1
                                          Fill: =gblTheme.Surface
                                          Height: =Parent.TemplateHeight - 4
                                          Width: =Parent.Width - 8
                                          X: =4
                                          Y: =2
                                    - lblGreaseVendor:
                                        Control: Label@2.5.1
                                        Properties:
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =25
                                          Size: =14 * gblDevice.FontScale
                                          Text: =ThisItem.'Vendor Name'.Value
                                          Width: =Parent.Width - 120
                                          X: =20
                                          Y: =10
                                    - lblGreaseDate:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextTertiary
                                          Font: =Font.'Segoe UI'
                                          Height: =20
                                          Size: =12 * gblDevice.FontScale
                                          Text: =Text(ThisItem.'Date of Service', "mm/dd/yyyy")
                                          Width: =Parent.Width - 120
                                          X: =20
                                          Y: =35
                        - lblStep2Progress_1:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =gblTheme.TextTertiary
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              Size: =12 * gblDevice.FontScale
                              Text: |-
                                =Switch(locCurrentAuditStep,
                                      1, CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title)) & " permits reviewed",
                                      2, "Systems check " & If(togPotableWater.Value || togBackflow.Value, "in progress", "pending"),
                                      3, CountRows(colInventories) & " items inventoried",
                                      4, CountRows(Filter(colFindings, AuditStep = 4)) & " conditions documented",
                                      5, CountRows(colFindings) & " total findings to review"
                                    )
                              Width: =230
                              X: =Parent.Width - 250
                              Y: =50
                        - conOdors:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: =466
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =varSelectedSystemTab = "Odors"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =160
                            Children:
                              - lblOdorsTitle:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: ="⚠️ Odor Assessment"
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =20
                              - conOdorComplaints:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =100
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =70
                                  Children:
                                    - lblOdorComplaints:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Odor Complaints Received?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =20
                                    - togOdorComplaints:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnCheck: |-
                                            =Collect(
                                                                                      colFindings,
                                                                                      {
                                                                                          FindingID: GUID(),
                                                                                          Issue: "Odor complaints received",
                                                                                          Severity: "Minor",
                                                                                          Category: "Air Quality",
                                                                                          SubCategory: "Odors",
                                                                                          SpecificIssue: "Odor Complaints",
                                                                                          RootCause: "Operational Issue",
                                                                                          QuickFix: "Investigate odor sources",
                                                                                          Notes: "",
                                                                                          Photos: Table(),
                                                                                          Timestamp: Now(),
                                                                                          AuditStep: 2
                                                                                      }
                                                                                  );
                                                                                  Notify("Odor issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Warning
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =20
                              - conOdorDetails:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    BorderColor: =gblTheme.BorderLight
                                    BorderThickness: =1
                                    Height: =260
                                    Visible: =togOdorComplaints.Value
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =190
                                  Children:
                                    - lblOdorSource:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Describe Odor Sources:"
                                          Width: =Parent.Width - 40
                                          X: =20
                                          Y: =20
                                    - txtOdorSource:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Font: =Font.'Segoe UI'
                                          FontSize: =16 * gblDevice.FontScale
                                          Height: =120
                                          Mode: =TextMode.MultiLine
                                          Placeholder: ="Describe odor sources and characteristics..."
                                          Width: =Parent.Width - 40
                                          X: =20
                                          Y: =60
                                    - lblOdorControl:
                                        Control: Label@2.5.1
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          Font: =Font.'Segoe UI'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =30
                                          Size: =16 * gblDevice.FontScale
                                          Text: ="Odor Control Measures in Place?"
                                          Width: =Parent.Width - 160
                                          X: =20
                                          Y: =200
                                    - togOdorControl:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="No"
                                          Height: =40
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "No odor control measures",
                                                    Severity: "Minor",
                                                    Category: "Air Quality",
                                                    SubCategory: "Odors",
                                                    SpecificIssue: "Odor Control",
                                                    RootCause: "Missing Controls",
                                                    QuickFix: "Implement odor control measures",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 2
                                                }
                                            );
                                            Notify("Odor control issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Yes"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =195
                  - conStep1_Permits:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =1
                        Fill: =gblTheme.Surface
                        Height: '=750 '
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Visible: =locCurrentAuditStep = 1
                        Width: =Parent.Width
                        Y: |+
                          =20
                      Children:
                        - galPermits:
                            Control: Gallery@2.15.0
                            Variant: BrowseLayout_Vertical_OneTextVariant_ver5.0
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              BorderThickness: =1
                              Height: =350
                              Items: =Filter(colPermits, Facility.Value = gblSelectedFacility.Title)
                              Visible: =!IsEmpty(Filter(colPermits, Facility.Value = gblSelectedFacility.Title))
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =110
                            Children:
                              - recPermitBg:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    BorderColor: =If(!IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(), gblTheme.Error, gblTheme.BorderLight)
                                    BorderThickness: =1
                                    Fill: =If(!IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(), gblTheme.ErrorLight, gblTheme.Surface)
                                    Height: =Parent.TemplateHeight - 4
                                    Width: =Parent.Width - 8
                                    X: =4
                                    Y: =2
                              - lblPermitType:
                                  Control: Label@2.5.1
                                  Properties:
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =25
                                    Size: =16 * gblDevice.FontScale
                                    Text: =ThisItem.'Permit Type'.Value & " (" & ThisItem.'Regulatory Agency'.Value & ")"
                                    Width: =Parent.Width - 150
                                    X: =20
                                    Y: =15
                              - lblPermitStatus_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =If(!IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(), gblTheme.Error, gblTheme.TextSecondary)
                                    Height: =20
                                    Size: =14 * gblDevice.FontScale
                                    Text: |-
                                      =If(!IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(), "⚠️ Expired: " & Text(ThisItem.'Expiration Date', "mm/dd/yyyy"), ThisItem.Status.Value & If(!IsBlank(ThisItem.'Expiration Date'), " (Exp: " & Text(ThisItem.'Expiration Date', "mm/dd/yyyy") & ")", ""))
                                    Width: =Parent.Width - 150
                                    X: =20
                                    Y: =45
                              - btnFlagPermit:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =gblTheme.TextPrimary
                                    Fill: =gblTheme.Warning
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =50
                                    OnSelect: |-
                                      =Collect(
                                          colFindings,
                                          {
                                              FindingID: GUID(),
                                              Issue: ThisItem.'Permit Type'.Value & " Issue: " & If(
                                                  !IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(),
                                                  "Expired",
                                                  ThisItem.Status.Value
                                              ),
                                              Severity: If(
                                                  !IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today(),
                                                  "Critical",
                                                  "High"
                                              ),
                                              Category: "Permits",
                                              SubCategory: "Compliance",
                                              SpecificIssue: ThisItem.'Permit Type'.Value,
                                              RootCause: "Permit Status",
                                              QuickFix: "Review and update permit status",
                                              Notes: "",
                                              Photos: Table(),
                                              Timestamp: Now(),
                                              AuditStep: 1
                                          }
                                      );
                                      Notify("Permit issue flagged - review in Step 5", NotificationType.Information, 2000);
                                    RadiusBottomLeft: =8
                                    RadiusBottomRight: =8
                                    RadiusTopLeft: =8
                                    RadiusTopRight: =8
                                    Size: =14 * gblDevice.FontScale
                                    Text: |-
                                      ="🚩 Flag Issue"
                                    Visible: =ThisItem.Status.Value <> "Complete" || (!IsBlank(ThisItem.'Expiration Date') && ThisItem.'Expiration Date' < Today())
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =15
                        - lblPermitsTitle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextSecondary
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Bold
                              Size: =20 * gblDevice.FontScale
                              Text: |-
                                ="📋 Permits & Compliance Requirements"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =20
                        - lblPermitStatus:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextTertiary
                              Font: =Font.'Segoe UI'
                              Height: =30
                              Size: =14 * gblDevice.FontScale
                              Text: ="Found " & CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title)) & " permit(s) on file for this facility"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =70
                        - conSPCC:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType in ["ECR", "SPCC"]
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =110
                            Children:
                              - lblSPCC:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="🛢️ SPCC Plan Required?"
                                    Width: =Parent.Width - 200
                                    X: =20
                                    Y: =20
                              - togSPCCReq:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Default: =CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title And 'Permit Type'.Value = "SPCC Plan")) > 0
                                    FalseText: ="No"
                                    Height: =40
                                    OnCheck: =Set(varShowSPCC, true)
                                    OnUncheck: =Set(varShowSPCC, false)
                                    TrueFill: =gblTheme.Success
                                    TrueText: ="Yes"
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =15
                              - conSPCCDetails:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    Height: =100
                                    Visible: =varShowSPCC
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =80
                                  Children:
                                    - dpSPCCReview:
                                        Control: Classic/DatePicker@2.6.0
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Font: =Font.'Segoe UI'
                                          Height: =60
                                          Size: =16 * gblDevice.FontScale
                                          Width: =200
                                          X: =20
                                          Y: =20
                                    - togCurrentSPCC:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="Expired"
                                          Height: =40
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "No current SPCC plan",
                                                    Severity: "High",
                                                    Category: "Permits",
                                                    SubCategory: "SPCC",
                                                    SpecificIssue: "SPCC Plan Status",
                                                    RootCause: "Expired/Missing Plan",
                                                    QuickFix: "Update SPCC plan",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 1
                                                }
                                            );
                                            Notify("SPCC issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Current"
                                          Width: =120
                                          X: =Parent.Width - 140
                                          Y: =40
                        - conNPDES:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType in ["ECR", "SWPPP"]
                              Width: =Parent.Width - 40
                              X: =20
                              Y: |-
                                =If(
                                          gblAuditType = "ECR" && varShowAirPermit, 
                                          conAirPermit.Y + conAirPermit.Height + 20,
                                          If(varShowTierII, conTierII.Y + conTierII.Height + 20,
                                             If(varShowSPCC, conSPCC.Y + conSPCC.Height + 20, 470))
                                      )
                            Children:
                              - lblNPDES:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="💧 NPDES Permit Required?"
                                    Width: =Parent.Width - 200
                                    X: =20
                                    Y: =20
                              - togNPDESReq:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    FalseText: ="No"
                                    Height: =40
                                    OnCheck: =Set(varShowNPDES, true)
                                    OnUncheck: =Set(varShowNPDES, false)
                                    TrueFill: =gblTheme.Success
                                    TrueText: ="Yes"
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =15
                              - conNPDESDetails:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    Height: =100
                                    Visible: =varShowNPDES
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =80
                                  Children:
                                    - txtNPDESNum:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =16 * gblDevice.FontScale
                                          Height: =60
                                          Placeholder: ="Permit Number"
                                          Value: =First(Filter(colPermits, Facility.Value = gblSelectedFacility.Title And 'Permit Type'.Value = "NPDES")).'Permit/Registration Number'
                                          Width: =250
                                          X: =20
                                          Y: =20
                                    - ddPermitStatus:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          Font: =Font.'Segoe UI'
                                          Height: =60
                                          Items: =["Filed and approved", "Filed pending approval", "Not filed", "Expired"]
                                          Items.Value: =Value
                                          OnChange: |-
                                            =If(
                                                Self.Selected.Value <> "Filed and approved",
                                                Collect(
                                                    colFindings,
                                                    {
                                                        FindingID: GUID(),
                                                        Issue: "NPDES Permit: " & Self.Selected.Value,
                                                        Severity: "High",
                                                        Category: "Permits",
                                                        SubCategory: "NPDES",
                                                        SpecificIssue: "Permit Status", 
                                                        RootCause: "Permit Filing Issue",
                                                        QuickFix: "File or renew NPDES permit",
                                                        Notes: "",
                                                        Photos: Table(),
                                                        Timestamp: Now(),
                                                        AuditStep: 1
                                                    }
                                                );
                                                Notify("NPDES issue flagged - review in Step 5", NotificationType.Information, 2000);
                                            );
                                          Size: =16 * gblDevice.FontScale
                                          Width: =200
                                          X: =290
                                          Y: =20
                        - conAirPermit:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: |+
                                =180
                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType = "ECR"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: |-
                                =If(
                                          gblAuditType = "ECR",
                                          If(varShowTierII, conTierII.Y + conTierII.Height + 20, 
                                             If(varShowSPCC, conSPCC.Y + conSPCC.Height + 20, 280)),
                                          9999
                                      )
                            Children:
                              - lblAirPermit:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="🌬️ Air Permit Required?"
                                    Width: =Parent.Width - 200
                                    X: =20
                                    Y: =20
                              - togAirPermitReq:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    FalseText: ="No"
                                    Height: =40
                                    OnCheck: =Set(varShowAirPermit, true)
                                    OnUncheck: =Set(varShowAirPermit, false)
                                    TrueFill: =gblTheme.Success
                                    TrueText: ="Yes"
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =15
                              - conAirDetails:
                                  Control: GroupContainer@1.3.0
                                  Variant: ManualLayout
                                  Properties:
                                    Height: =100
                                    Visible: =varShowAirPermit
                                    Width: =Parent.Width - 40
                                    X: =20
                                    Y: =80
                                  Children:
                                    - txtAirPermitNum:
                                        Control: TextInput@0.0.54
                                        Properties:
                                          BorderColor: =gblTheme.Border
                                          FontSize: =16 * gblDevice.FontScale
                                          Height: =60
                                          Placeholder: ="Air Permit Number"
                                          Width: =250
                                          X: =20
                                          Y: =20
                                    - togCurrentAirPermit:
                                        Control: Classic/Toggle@2.1.0
                                        Properties:
                                          Color: =gblTheme.TextSecondary
                                          FalseText: ="Expired"
                                          Height: =40
                                          OnUncheck: |-
                                            =Collect(
                                                colFindings,
                                                {
                                                    FindingID: GUID(),
                                                    Issue: "No current Air Permit",
                                                    Severity: "High",
                                                    Category: "Permits",
                                                    SubCategory: "Air Quality",
                                                    SpecificIssue: "Air Permit Status",
                                                    RootCause: "Expired/Missing Permit",
                                                    QuickFix: "Renew air permit",
                                                    Notes: "",
                                                    Photos: Table(),
                                                    Timestamp: Now(),
                                                    AuditStep: 1
                                                }
                                            );
                                            Notify("Air permit issue flagged - review in Step 5", NotificationType.Information, 2000);
                                          TrueFill: =gblTheme.Success
                                          TrueText: ="Current"
                                          Width: =120
                                          X: =290
                                          Y: =20
                        - conTierII:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              BorderColor: =gblTheme.BorderLight
                              BorderThickness: =1
                              Fill: =gblTheme.Surface
                              Height: |+
                                =150

                              RadiusBottomLeft: =8
                              RadiusBottomRight: =8
                              RadiusTopLeft: =8
                              RadiusTopRight: =8
                              Visible: =gblAuditType = "ECR"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: |+
                                =If(varShowSPCC, conSPCC.Y + conSPCC.Height + 20, 110)
                            Children:
                              - lblTierII:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =30
                                    Size: =18 * gblDevice.FontScale
                                    Text: |-
                                      ="📊 Tier II Reporting Required?"
                                    Width: =Parent.Width - 200
                                    X: =20
                                    Y: =20
                              - togTierIIReq:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    FalseText: ="No"
                                    Height: =40
                                    OnCheck: =Set(varShowTierII, true)
                                    OnUncheck: =Set(varShowTierII, false)
                                    TrueFill: =gblTheme.Success
                                    TrueText: ="Yes"
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =15
                              - togTierIIFiled:
                                  Control: Classic/Toggle@2.1.0
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    FalseText: ="Not Filed"
                                    Height: =40
                                    OnUncheck: |-
                                      =Collect(
                                          colFindings,
                                          {
                                              FindingID: GUID(),
                                              Issue: "Tier II not filed on time",
                                              Severity: "High",
                                              Category: "Permits",
                                              SubCategory: "Emergency Planning",
                                              SpecificIssue: "Tier II Filing",
                                              RootCause: "Missing Filing",
                                              QuickFix: "File Tier II report",
                                              Notes: "",
                                              Photos: Table(),
                                              Timestamp: Now(),
                                              AuditStep: 1
                                          }
                                      );
                                      Notify("Tier II issue flagged - review in Step 5", NotificationType.Information, 2000);
                                    TrueFill: =gblTheme.Success
                                    TrueText: ="Filed"
                                    Visible: =varShowTierII
                                    Width: =120
                                    X: =Parent.Width - 140
                                    Y: =80
                        - lblStep5Progress:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =gblTheme.TextTertiary
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              Size: =12 * gblDevice.FontScale
                              Text: |-
                                =Switch(locCurrentAuditStep,
                                      1, CountRows(Filter(colPermits, Facility.Value = gblSelectedFacility.Title)) & " permits reviewed",
                                      2, "Systems check " & If(togPotableWater.Value || togBackflow.Value, "in progress", "pending"),
                                      3, CountRows(colInventories) & " items inventoried",
                                      4, CountRows(Filter(colFindings, AuditStep = 4)) & " conditions documented",
                                      5, CountRows(colFindings) & " total findings to review"
                                    )
                              Width: =230
                              X: =Parent.Width - 250
                              Y: =50
                  - conStep5_FindingsReview:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =1
                        Fill: =gblTheme.Surface
                        Height: =704
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Visible: =locCurrentAuditStep = 5
                        Width: =Parent.Width
                        Y: =20
                      Children:
                        - lblFindingsTitle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =gblTheme.TextSecondary
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Bold
                              Size: =20 * gblDevice.FontScale
                              Text: ="Findings Review & Finalization"
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =60
                        - galFindingsReview:
                            Control: Gallery@2.15.0
                            Variant: BrowseLayout_Vertical_TwoTextVariant_ver5.0
                            Properties:
                              BorderColor: =RGBA(245, 245, 245, 1)
                              BorderThickness: =1
                              Height: =573
                              Items: =Sort(colFindings, Timestamp, SortOrder.Descending)
                              TemplateSize: =If(gblDevice.IsPhone, 340, 230)
                              Width: =Parent.Width - 40
                              X: =20
                              Y: =120
                            Children:
                              - recFindingBg_1:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    BorderColor: =Switch(ThisItem.Severity, "Major", gblTheme.Error, "Minor", gblTheme.Warning, gblTheme.BorderLight)
                                    BorderThickness: =2
                                    Fill: =gblTheme.Surface
                                    Height: =Parent.TemplateHeight - 8
                                    Width: =Parent.Width - 8
                                    X: =4
                                    Y: =4
                              - lblFindingHeader:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextSecondary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =If(gblDevice.IsPhone, 45, 30)
                                    Size: =If(gblDevice.IsPhone, 12, 14) * gblDevice.FontScale
                                    Text: ="Step " & ThisItem.AuditStep & " | " & ThisItem.Category & " - " & ThisItem.SubCategory
                                    Width: =If(gblDevice.IsPhone, Parent.Width - 50, Parent.Width - 170)
                                    X: =20
                                    Y: =10
                              - ddFindingSeverity:
                                  Control: Classic/DropDown@2.3.1
                                  Properties:
                                    BorderColor: =Switch(Self.Selected.Value, "Major", gblTheme.Error, "Minor", gblTheme.Warning, gblTheme.BorderLight)
                                    Default: =ThisItem.Severity
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Items: =["Major", "Minor", "Observation"]
                                    Items.Value: =Value
                                    OnChange: |-
                                      =Patch(
                                          colFindings,
                                          LookUp(colFindings, FindingID = ThisItem.FindingID),
                                          {Severity: Self.Selected.Value}
                                      );
                                      Select(btnRecalculateScore);
                                    Size: =If(gblDevice.IsPhone, 11, 13) * gblDevice.FontScale
                                    Width: =If(gblDevice.IsPhone, 110, 130)
                                    X: =If(gblDevice.IsPhone, 20, Parent.Width - 150)
                                    Y: =If(gblDevice.IsPhone, 60, 10)
                              - txtFindingIssue:
                                  Control: TextInput@0.0.54
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    FontSize: =If(gblDevice.IsPhone, 12, 13) * gblDevice.FontScale
                                    Height: =50
                                    Mode: =TextMode.SingleLine
                                    OnChange: |-
                                      =Patch(
                                          colFindings,
                                          LookUp(colFindings, FindingID = ThisItem.FindingID),
                                          {Issue: Self.Value}
                                      );
                                    Placeholder: ="Issue description"
                                    Value: =ThisItem.Issue
                                    Width: =Parent.Width - 50
                                    X: =20
                                    Y: =If(gblDevice.IsPhone, 110, 60)
                              - lblQuickFixLabel:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextTertiary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =20
                                    Size: =11 * gblDevice.FontScale
                                    Text: ="Quick Fix:"
                                    Width: =85
                                    X: =20
                                    Y: =If(gblDevice.IsPhone, 170, 120)
                              - txtQuickFix:
                                  Control: TextInput@0.0.54
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    FontSize: =If(gblDevice.IsPhone, 11, 12) * gblDevice.FontScale
                                    Height: =40
                                    OnChange: |-
                                      =Patch(
                                          colFindings,
                                          LookUp(colFindings, FindingID = ThisItem.FindingID),
                                          {QuickFix: Self.Value}
                                      );
                                    Placeholder: ="Recommended action"
                                    Value: =ThisItem.QuickFix
                                    Width: =If(gblDevice.IsPhone, Parent.Width - 120, Parent.Width - 220)
                                    X: =If(gblDevice.IsPhone, 110, 110)
                                    Y: =If(gblDevice.IsPhone, 168, 118)
                              - btnAttachPhoto:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    Color: =gblTheme.TextSecondary
                                    Fill: =gblTheme.Surface
                                    Font: =Font.'Segoe UI'
                                    Height: =38
                                    OnSelect: |-
                                      =Set(gblCurrentFinding, ThisItem);
                                      Set(varShowCamera, true);
                                      Set(varGeneralPhoto, false);
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Size: =If(gblDevice.IsPhone, 10, 11) * gblDevice.FontScale
                                    Text: ="Photo (" & CountRows(Filter(colFindingPhotos, FindingID = ThisItem.FindingID)) & ")"
                                    Width: =If(gblDevice.IsPhone, 85, 95)
                                    X: =If(gblDevice.IsPhone, Parent.Width - 190, Parent.Width - 200)
                                    Y: =If(gblDevice.IsPhone, 168, 118)
                              - btnDeleteFinding:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =gblTheme.Error
                                    Color: =gblTheme.Error
                                    Fill: =gblTheme.Surface
                                    Font: =Font.'Segoe UI'
                                    Height: =38
                                    OnSelect: |-
                                      =Remove(colFindings, ThisItem);
                                      RemoveIf(colFindingPhotos, FindingID = ThisItem.FindingID);
                                      Select(btnRecalculateScore);
                                      Notify("Finding removed", NotificationType.Information);
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Size: =If(gblDevice.IsPhone, 10, 11) * gblDevice.FontScale
                                    Text: ="Delete"
                                    Width: =If(gblDevice.IsPhone, 80, 85)
                                    X: =If(gblDevice.IsPhone, Parent.Width - 95, Parent.Width - 95)
                                    Y: =If(gblDevice.IsPhone, 168, 118)
                              - lblNotesLabel:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =gblTheme.TextTertiary
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =20
                                    Size: =11 * gblDevice.FontScale
                                    Text: ="Notes:"
                                    Width: =65
                                    X: =20
                                    Y: =If(gblDevice.IsPhone, 218, 168)
                              - txtFindingNotes:
                                  Control: TextInput@0.0.54
                                  Properties:
                                    BorderColor: =gblTheme.Border
                                    FontSize: =If(gblDevice.IsPhone, 11, 12) * gblDevice.FontScale
                                    Height: =If(gblDevice.IsPhone, 80, 50)
                                    Mode: =TextMode.MultiLine
                                    OnChange: |-
                                      =Patch(
                                          colFindings,
                                          LookUp(colFindings, FindingID = ThisItem.FindingID),
                                          {Notes: Self.Value}
                                      );
                                    Placeholder: ="Additional details (optional)"
                                    Value: =ThisItem.Notes
                                    Width: =Parent.Width - 110
                                    X: =90
                                    Y: =If(gblDevice.IsPhone, 215, 166)
                              - lblNoFindings:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    Color: =gblTheme.Success
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =90
                                    Size: =18 * gblDevice.FontScale
                                    Text: ="No findings identified - Great job!"
                                    Visible: =CountRows(colFindings) = 0
                                    Width: =Parent.Width
      - conCameraPopup:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(0, 0, 0, 0.5)
            Height: =Parent.Height
            Visible: =varShowCamera
            Width: =Parent.Width
          Children:
            - conCameraContainer:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  Fill: =gblTheme.Surface
                  Height: =If(gblDevice.IsPhone, Parent.Height - 100, 600)
                  RadiusBottomLeft: =12
                  RadiusBottomRight: =12
                  RadiusTopLeft: =12
                  RadiusTopRight: =12
                  Width: =768
                  Y: =(Parent.Height - Self.Height) / 2
                Children:
                  - lblCameraTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =gblTheme.TextSecondary
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Size: =18 * gblDevice.FontScale
                        Text: =If(varGeneralPhoto, "Take General Photo", "Add Photo to Finding")
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =20
                  - camFinding:
                      Control: Camera@2.4.0
                      Properties:
                        BorderColor: =gblTheme.Border
                        BorderThickness: =2
                        Camera: =0
                        Height: =If(gblDevice.IsPhone, Parent.Height - 180, 400)
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =60
                  - btnCapturePhoto:
                      Control: Classic/Button@2.2.0
                      Properties:
                        Color: =gblTheme.TextPrimary
                        Fill: =gblTheme.Success
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =60
                        OnSelect: |-
                          =If(
                              !IsBlank(camFinding.Photo),
                              If(
                                  varGeneralPhoto,
                                  Collect(
                                      colGeneralPhotos,
                                      {
                                          PhotoID: GUID(),
                                          Photo: camFinding.Photo,
                                          FileName: "General_" & Text(Now(), "yyyymmdd_hhmmss") & ".jpg",
                                          Timestamp: Now(),
                                          Context: varCurrentPhotoContext
                                      }
                                  );
                                  Notify("General photo captured!", NotificationType.Success);,
                                  Collect(
                                      colFindingPhotos,
                                      {
                                          FindingID: gblCurrentFinding.FindingID,
                                          Photo: camFinding.Photo,
                                          FileName: "Finding_" & Text(Now(), "yyyymmdd_hhmmss") & ".jpg"
                                      }
                                  );
                                  Notify("Photo added to finding!", NotificationType.Success);
                              );
                              Set(varShowCamera, false);
                              Set(varGeneralPhoto, false);,
                              Notify("Camera did not capture an image", NotificationType.Warning)
                          )
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Size: =14 * gblDevice.FontScale
                        Text: |-
                          ="📷 Capture Photo"
                        Width: =200
                        X: =(Parent.Width - 350) / 2
                        Y: =Parent.Height - 100
                  - btnCancelCamera:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =gblTheme.Border
                        Color: =gblTheme.TextSecondary
                        Fill: =gblTheme.Surface
                        Font: =Font.'Segoe UI'
                        Height: =60
                        OnSelect: |-
                          =Set(varShowCamera, false);
                          Set(varGeneralPhoto, false);
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Size: =14 * gblDevice.FontScale
                        Text: ="Cancel"
                        Width: =120
                        X: =422
                        Y: =Parent.Height - 100
      - conFloatingCamera:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            DropShadow: =DropShadow.Semibold
            Fill: =gblTheme.Primary
            Height: =If(gblDevice.IsPhone, 60, 80)
            RadiusBottomLeft: =40
            RadiusBottomRight: =40
            RadiusTopLeft: =40
            RadiusTopRight: =40
            Width: =If(gblDevice.IsPhone, 60, 80)
            X: =Parent.Width - Self.Width - 20
            Y: =Parent.Height - Self.Height - 120
          Children:
            - btnFloatingCamera:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 0)
                  Color: =gblTheme.TextPrimary
                  Fill: =gblTheme.Primary
                  Font: =Font.'Segoe UI'
                  FontWeight: =FontWeight.Bold
                  Height: =Parent.Height
                  HoverFill: =ColorFade(gblTheme.Primary, -10%)
                  OnSelect: |-
                    =Set(varCurrentPhotoContext, "General");
                    Set(varShowCamera, true);
                    Set(varGeneralPhoto, true);
                  PressedFill: =ColorFade(gblTheme.Primary, -20%)
                  RadiusBottomLeft: =40
                  RadiusBottomRight: =40
                  RadiusTopLeft: =40
                  RadiusTopRight: =40
                  Size: =24
                  Text: |-
                    ="📷"
                  Width: =Parent.Width
            - Label1:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 0)
                  BorderStyle: =BorderStyle.None
                  BorderThickness: =2
                  Color: =gblTheme.TextPrimary
                  DisabledBorderColor: =RGBA(0, 0, 0, 0)
                  DisabledColor: =RGBA(161, 159, 157, 1)
                  Fill: =gblTheme.Error
                  FocusedBorderThickness: =4
                  Font: =Font.'Segoe UI'
                  Height: =24
                  Text: =CountRows(colGeneralPhotos)
                  Visible: =CountRows(colGeneralPhotos) > 0
                  Width: =24
                  X: =Parent.Width - 15
      - conNavigation:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            BorderColor: =gblTheme.Border
            BorderThickness: =1
            Fill: =gblTheme.Surface
            Height: =100
            Width: =Parent.Width
            Y: =Parent.Height - Self.Height
          Children:
            - btnPreviousStep:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =gblTheme.Border
                  BorderThickness: =1
                  Color: =gblTheme.TextSecondary
                  Fill: =gblTheme.Surface
                  Font: =Font.'Segoe UI'
                  FontWeight: =FontWeight.Bold
                  Height: =70
                  HoverFill: =gblTheme.SurfaceHover
                  OnSelect: |-
                    =UpdateContext({locCurrentAuditStep: Max(1, locCurrentAuditStep - 1)})
                  RadiusBottomLeft: =8
                  RadiusBottomRight: =8
                  RadiusTopLeft: =8
                  RadiusTopRight: =8
                  Size: =16 * gblDevice.FontScale
                  Text: ="← Previous"
                  Visible: =locCurrentAuditStep > 1
                  Width: =150
                  X: =20
                  Y: =15
            - lblCurrentStep:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Center
                  Color: =gblTheme.TextSecondary
                  Font: =Font.'Segoe UI'
                  FontWeight: =FontWeight.Semibold
                  Height: =30
                  Size: =16 * gblDevice.FontScale
                  Text: ="Step " & locCurrentAuditStep & " of 5"
                  Width: =200
                  X: =(Parent.Width - Self.Width) / 2
                  Y: =35
            - btnNextStep:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =gblTheme.Border
                  BorderThickness: =1
                  Color: =gblTheme.TextPrimary
                  Fill: =gblTheme.Accent
                  Font: =Font.'Segoe UI'
                  FontWeight: =FontWeight.Bold
                  Height: =70
                  HoverFill: =ColorFade(gblTheme.Accent, -10%)
                  OnSelect: |-
                    =UpdateContext({locCurrentAuditStep: Min(5, locCurrentAuditStep + 1)})
                  RadiusBottomLeft: =8
                  RadiusBottomRight: =8
                  RadiusTopLeft: =8
                  RadiusTopRight: =8
                  Size: =16 * gblDevice.FontScale
                  Text: ="Next →"
                  Visible: =locCurrentAuditStep < 5
                  Width: =150
                  X: =Parent.Width - 170
                  Y: =15
            - btnFinishAudit:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =gblTheme.Success
                  Color: =gblTheme.TextPrimary
                  Fill: =gblTheme.Success
                  Font: =Font.'Segoe UI'
                  FontWeight: =FontWeight.Bold
                  Height: =70
                  HoverFill: =ColorFade(gblTheme.Success, -10%)
                  OnSelect: =Navigate(scrSubmit, ScreenTransition.Fade)
                  RadiusBottomLeft: =8
                  RadiusBottomRight: =8
                  RadiusTopLeft: =8
                  RadiusTopRight: =8
                  Size: =16 * gblDevice.FontScale
                  Text: ="✓ Finish Audit"
                  Visible: =locCurrentAuditStep = 5
                  Width: =200
                  X: =Parent.Width - 220
                  Y: =15
      - conProgress_2:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =gblTheme.Surface
            Height: =100
            Width: =Parent.Width
            Y: =hedAuditHeader.Height
          Children:
            - galAuditProgress_1:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Horizontal_TwoTextOneImageOverlayVariant_ver5.0
                Properties:
                  Height: =90
                  Items: =gblAuditStages
                  OnSelect: =
                  ShowScrollbar: =false
                  TemplateSize: =(Parent.Width - 30 - (5 * 10)) / 5
                  Width: =Parent.Width - 30
                  WrapCount: |+
                    =0
                  X: =15
                  Y: =5
                Children:
                  - recProgressStep_1:
                      Control: Rectangle@2.3.0
                      Properties:
                        BorderColor: =If(ThisItem.Stage = locCurrentAuditStep, gblTheme.Accent, gblTheme.BorderLight)
                        BorderThickness: =If(ThisItem.Stage = locCurrentAuditStep, 2, 1)
                        Fill: =If(ThisItem.Stage < locCurrentAuditStep, gblTheme.SuccessLight, If(ThisItem.Stage = locCurrentAuditStep, gblTheme.AccentLight, gblTheme.Surface))
                        Height: =Parent.TemplateHeight - 4
                        OnSelect: |-
                          =UpdateContext({locCurrentAuditStep: ThisItem.Stage})
                        Width: =Parent.TemplateWidth - 8
                        X: =4
                        Y: |+
                          =2
                  - icoProgressStep_1:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        Color: =If(ThisItem.Stage <= locCurrentAuditStep, gblTheme.Primary, gblTheme.TextTertiary)
                        Height: =32
                        Icon: =ThisItem.Icon
                        Width: =28
                        X: =54
                        Y: =5
                  - lblProgressTitle_1:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =If(ThisItem.Stage <= locCurrentAuditStep, gblTheme.TextSecondary, gblTheme.TextTertiary)
                        Font: =Font.'Segoe UI'
                        FontWeight: =If(ThisItem.Stage = locCurrentAuditStep, FontWeight.Bold, FontWeight.Normal)
                        Height: =39
                        Size: =12 * gblDevice.FontScale
                        Text: =ThisItem.Title
                        Width: =Parent.TemplateWidth - 8
                        X: =4
                        Y: =43
